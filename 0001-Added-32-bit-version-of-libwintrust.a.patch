From 459e8d4f33254e39a59680bc06b3dca78c5c6b1f Mon Sep 17 00:00:00 2001
From: Erik van Pienbroek <epienbro@fedoraproject.org>
Date: Wed, 31 Dec 2014 22:59:14 +0100
Subject: [PATCH] Added 32-bit version of libwintrust.a

This is partial cherry-pick of commit 2bbc229056418ef6c7ae6e2530ee68fe4e518e15
---
 mingw-w64-crt/Makefile.in        |  34 +++++-----
 mingw-w64-crt/lib32/Makefile.am  |   1 +
 mingw-w64-crt/lib32/wintrust.def | 137 +++++++++++++++++++++++++++++++++++++++
 3 files changed, 155 insertions(+), 17 deletions(-)
 create mode 100644 mingw-w64-crt/lib32/wintrust.def

diff --git a/mingw-w64-crt/lib32/Makefile.am b/mingw-w64-crt/lib32/Makefile.am
index cf300d7..b548f36 100644
--- a/mingw-w64-crt/lib32/Makefile.am
+++ b/mingw-w64-crt/lib32/Makefile.am
@@ -291,6 +291,7 @@ lib32_DATA += %reldir%/libwinmm.a
 lib32_DATA += %reldir%/libwinscard.a
 lib32_DATA += %reldir%/libwinspool.a
 lib32_DATA += %reldir%/libwinstrm.a
+lib32_DATA += %reldir%/libwintrust.a
 lib32_DATA += %reldir%/libwinusb.a
 lib32_DATA += %reldir%/libwkscli.a
 lib32_DATA += %reldir%/libwlanapi.a
diff --git a/mingw-w64-crt/lib32/wintrust.def b/mingw-w64-crt/lib32/wintrust.def
new file mode 100644
index 0000000..fbff4e7
--- /dev/null
+++ b/mingw-w64-crt/lib32/wintrust.def
@@ -0,0 +1,137 @@
+;
+; Definition file of WINTRUST.dll
+; Automatic generated by gendef
+; written by Kai Tietz 2008
+;
+LIBRARY "WINTRUST.dll"
+EXPORTS
+CryptCATVerifyMember@12
+CryptSIPGetInfo@4
+CryptSIPGetRegWorkingFlags@4
+GenericChainCertificateTrust@4
+GenericChainFinalProv@4
+HTTPSCertificateTrust@4
+SoftpubDefCertInit@4
+SoftpubFreeDefUsageCallData@8
+SoftpubLoadDefUsageCallData@8
+WTHelperCertFindIssuerCertificate@28
+AddPersonalTrustDBPages@12
+CatalogCompactHashDatabase@16
+CryptCATAdminAcquireContext@12
+CryptCATAdminAddCatalog@16
+CryptCATAdminCalcHashFromFileHandle@16
+CryptCATAdminEnumCatalogFromHash@20
+CryptCATAdminPauseServiceForBackup@8
+CryptCATAdminReleaseCatalogContext@12
+CryptCATAdminReleaseContext@8
+CryptCATAdminRemoveCatalog@12
+CryptCATAdminResolveCatalogPath@16
+CryptCATAllocSortedMemberInfo@8
+CryptCATCDFClose@4
+CryptCATCDFEnumAttributes@16
+CryptCATCDFEnumAttributesWithCDFTag@20
+CryptCATCDFEnumCatAttributes@12
+CryptCATCDFEnumMembers@12
+CryptCATCDFEnumMembersByCDFTag@16
+CryptCATCDFEnumMembersByCDFTagEx@24
+CryptCATCDFOpen@8
+CryptCATCatalogInfoFromContext@12
+CryptCATClose@4
+CryptCATEnumerateAttr@12
+CryptCATEnumerateCatAttr@8
+CryptCATEnumerateMember@8
+CryptCATFreeSortedMemberInfo@8
+CryptCATGetAttrInfo@12
+CryptCATGetCatAttrInfo@8
+CryptCATGetMemberInfo@8
+CryptCATHandleFromStore@4
+CryptCATOpen@20
+CryptCATPersistStore@4
+CryptCATPutAttrInfo@24
+CryptCATPutCatAttrInfo@20
+CryptCATPutMemberInfo@28
+CryptCATStoreFromHandle@4
+CryptSIPCreateIndirectData@12
+CryptSIPGetSignedDataMsg@20
+CryptSIPPutSignedDataMsg@20
+CryptSIPRemoveSignedDataMsg@8
+CryptSIPVerifyIndirectData@8
+DllRegisterServer
+DllUnregisterServer
+DriverCleanupPolicy@4
+DriverFinalPolicy@4
+DriverInitializePolicy@4
+FindCertsByIssuer@28
+HTTPSFinalProv@4
+IsCatalogFile@8
+MsCatConstructHashTag@12
+MsCatFreeHashTag@4
+OfficeCleanupPolicy@4
+OfficeInitializePolicy@4
+OpenPersonalTrustDBDialog@4
+OpenPersonalTrustDBDialogEx@12
+SoftpubAuthenticode@4
+SoftpubCheckCert@16
+SoftpubCleanup@4
+SoftpubDllRegisterServer
+SoftpubDllUnregisterServer
+SoftpubDumpStructure@4
+SoftpubInitialize@4
+SoftpubLoadMessage@4
+SoftpubLoadSignature@4
+TrustDecode@36
+TrustFindIssuerCertificate@32
+TrustFreeDecode@8
+TrustIsCertificateSelfSigned@12
+TrustOpenStores@16
+WTHelperCertCheckValidSignature@4
+WTHelperCertIsSelfSigned@8
+WTHelperCheckCertUsage@8
+WTHelperGetAgencyInfo@12
+WTHelperGetFileHandle@4
+WTHelperGetFileHash@24
+WTHelperGetFileName@4
+WTHelperGetKnownUsages@8
+WTHelperGetProvCertFromChain@8
+WTHelperGetProvPrivateDataFromChain@8
+WTHelperGetProvSignerFromChain@16
+WTHelperIsInRootStore@8
+WTHelperOpenKnownStores@4
+WTHelperProvDataFromStateData@4
+WVTAsn1CatMemberInfoDecode@28
+WVTAsn1CatMemberInfoEncode@20
+WVTAsn1CatNameValueDecode@28
+WVTAsn1CatNameValueEncode@20
+WVTAsn1SpcFinancialCriteriaInfoDecode@28
+WVTAsn1SpcFinancialCriteriaInfoEncode@20
+WVTAsn1SpcIndirectDataContentDecode@28
+WVTAsn1SpcIndirectDataContentEncode@20
+WVTAsn1SpcLinkDecode@28
+WVTAsn1SpcLinkEncode@20
+WVTAsn1SpcMinimalCriteriaInfoDecode@28
+WVTAsn1SpcMinimalCriteriaInfoEncode@20
+WVTAsn1SpcPeImageDataDecode@28
+WVTAsn1SpcPeImageDataEncode@20
+WVTAsn1SpcSigInfoDecode@28
+WVTAsn1SpcSigInfoEncode@20
+WVTAsn1SpcSpAgencyInfoDecode@28
+WVTAsn1SpcSpAgencyInfoEncode@20
+WVTAsn1SpcSpOpusInfoDecode@28
+WVTAsn1SpcSpOpusInfoEncode@20
+WVTAsn1SpcStatementTypeDecode@28
+WVTAsn1SpcStatementTypeEncode@20
+WinVerifyTrust@12
+WinVerifyTrustEx@12
+WintrustAddActionID@12
+WintrustAddDefaultForUsage@8
+WintrustCertificateTrust@4
+WintrustGetDefaultForUsage@12
+WintrustGetRegPolicyFlags@4
+WintrustLoadFunctionPointers@8
+WintrustRemoveActionID@4
+WintrustSetDefaultIncludePEPageHashes@4
+WintrustSetRegPolicyFlags@4
+mscat32DllRegisterServer
+mscat32DllUnregisterServer
+mssip32DllRegisterServer
+mssip32DllUnregisterServer
-- 
2.1.0

--- a/mingw-w64-crt/Makefile.in.orig	2015-01-01 13:58:54.494782913 +0100
+++ b/mingw-w64-crt/Makefile.in	2015-01-01 13:59:07.182986859 +0100
@@ -4235,23 +4235,24 @@
 @LIB32_TRUE@	lib32/libwindowscodecs.a lib32/libwinhttp.a \
 @LIB32_TRUE@	lib32/libwininet.a lib32/libwinmm.a \
 @LIB32_TRUE@	lib32/libwinscard.a lib32/libwinspool.a \
-@LIB32_TRUE@	lib32/libwinstrm.a lib32/libwinusb.a \
-@LIB32_TRUE@	lib32/libwkscli.a lib32/libwlanapi.a \
-@LIB32_TRUE@	lib32/libwlanui.a lib32/libwlanutil.a \
-@LIB32_TRUE@	lib32/libwldap32.a lib32/libwow32.a \
-@LIB32_TRUE@	lib32/libwsdapi.a lib32/libwsnmp32.a \
-@LIB32_TRUE@	lib32/libwsock32.a lib32/libwst.a \
-@LIB32_TRUE@	lib32/libwtsapi32.a lib32/libx3daudio1_2.a \
-@LIB32_TRUE@	lib32/libx3daudio1_3.a lib32/libx3daudio1_4.a \
-@LIB32_TRUE@	lib32/libx3daudio1_5.a lib32/libx3daudio1_6.a \
-@LIB32_TRUE@	lib32/libx3daudio1_7.a lib32/libx3daudiod1_7.a \
-@LIB32_TRUE@	lib32/libxapofx1_0.a lib32/libxapofx1_1.a \
-@LIB32_TRUE@	lib32/libxapofx1_2.a lib32/libxapofx1_3.a \
-@LIB32_TRUE@	lib32/libxapofx1_4.a lib32/libxapofx1_5.a \
-@LIB32_TRUE@	lib32/libxapofxd1_5.a lib32/libxaudio2_8.a \
-@LIB32_TRUE@	lib32/libxinput1_1.a lib32/libxinput1_2.a \
-@LIB32_TRUE@	lib32/libxinput1_3.a lib32/libxinput1_4.a \
-@LIB32_TRUE@	lib32/libxinput9_1_0.a $(am__append_5)
+@LIB32_TRUE@	lib32/libwinstrm.a lib32/libwintrust.a \
+@LIB32_TRUE@	lib32/libwinusb.a lib32/libwkscli.a \
+@LIB32_TRUE@	lib32/libwlanapi.a lib32/libwlanui.a \
+@LIB32_TRUE@	lib32/libwlanutil.a lib32/libwldap32.a \
+@LIB32_TRUE@	lib32/libwow32.a lib32/libwsdapi.a \
+@LIB32_TRUE@	lib32/libwsnmp32.a lib32/libwsock32.a \
+@LIB32_TRUE@	lib32/libwst.a lib32/libwtsapi32.a \
+@LIB32_TRUE@	lib32/libx3daudio1_2.a lib32/libx3daudio1_3.a \
+@LIB32_TRUE@	lib32/libx3daudio1_4.a lib32/libx3daudio1_5.a \
+@LIB32_TRUE@	lib32/libx3daudio1_6.a lib32/libx3daudio1_7.a \
+@LIB32_TRUE@	lib32/libx3daudiod1_7.a lib32/libxapofx1_0.a \
+@LIB32_TRUE@	lib32/libxapofx1_1.a lib32/libxapofx1_2.a \
+@LIB32_TRUE@	lib32/libxapofx1_3.a lib32/libxapofx1_4.a \
+@LIB32_TRUE@	lib32/libxapofx1_5.a lib32/libxapofxd1_5.a \
+@LIB32_TRUE@	lib32/libxaudio2_8.a lib32/libxinput1_1.a \
+@LIB32_TRUE@	lib32/libxinput1_2.a lib32/libxinput1_3.a \
+@LIB32_TRUE@	lib32/libxinput1_4.a lib32/libxinput9_1_0.a \
+@LIB32_TRUE@	$(am__append_5)
 @LIB32_TRUE@dx32_DATA = lib32/libxinput.a lib32/libxapofx.a \
 @LIB32_TRUE@	lib32/libx3daudio.a lib32/libd3dx9.a \
 @LIB32_TRUE@	lib32/libd3dx10.a lib32/libd3dx11.a \
