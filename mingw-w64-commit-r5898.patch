Index: trunk/mingw-w64-crt/crt/msvcrt.c
===================================================================
--- trunk/mingw-w64-crt/crt/msvcrt.c	(revision 0)
+++ trunk/mingw-w64-crt/crt/msvcrt.c	(revision 5898)
@@ -0,0 +1,12 @@
+#include <windows.h>
+
+HMODULE __mingw_get_msvcrt_handle(void);
+HMODULE __mingw_get_msvcrt_handle(void)
+{
+    static HANDLE msvcrt_handle;
+
+    if(!msvcrt_handle)
+        msvcrt_handle = LoadLibraryW(L"msvcrt.dll");
+
+    return msvcrt_handle;
+}

Property changes on: trunk/mingw-w64-crt/crt/msvcrt.c
___________________________________________________________________
Added: svn:mime-type
## -0,0 +1 ##
+text/plain
\ No newline at end of property
Added: svn:eol-style
## -0,0 +1 ##
+native
\ No newline at end of property
Index: trunk/mingw-w64-crt/crt/pesect.c
===================================================================
--- trunk/mingw-w64-crt/crt/pesect.c	(revision 5897)
+++ trunk/mingw-w64-crt/crt/pesect.c	(revision 5898)
@@ -228,31 +228,3 @@
 
   return NULL;
 }
-
-HMODULE __mingw_get_msvcrt_handle(void);
-HMODULE __mingw_get_msvcrt_handle(void)
-{
-    static HANDLE msvcrt_handle;
-
-    if(!msvcrt_handle) {
-        const char *lib_name;
-        int i = 0;
-
-        while ((lib_name = __mingw_enum_import_library_names (i++))) {
-            if((lib_name[0] == 'm' || lib_name[0] == 'M')
-               && (lib_name[1] == 's' || lib_name[1] == 'S')
-               && (lib_name[2] == 'v' || lib_name[2] == 'V')
-               && (lib_name[3] == 'c' || lib_name[3] == 'C')
-               && (lib_name[4] == 'r' || lib_name[4] == 'R')
-               && (lib_name[5] == 't' || lib_name[5] == 'T' || ('0' <= lib_name[5] && lib_name[5] <= '9')))
-                break;
-        }
-
-       if(lib_name)
-            msvcrt_handle = GetModuleHandleA(lib_name);
-        if(!msvcrt_handle)
-            msvcrt_handle = LoadLibraryW(L"msvcrt.dll");
-    }
-
-    return msvcrt_handle;
-}
Index: trunk/mingw-w64-crt/Makefile.am
===================================================================
--- trunk/mingw-w64-crt/Makefile.am	(revision 5897)
+++ trunk/mingw-w64-crt/Makefile.am	(revision 5898)
@@ -118,6 +118,7 @@
   libsrc/wspiapi/WspiapiFreeAddrInfo.c
 
 src_msvcrt=\
+  crt/msvcrt.c \
   misc/invalid_parameter_handler.c \
   misc/lc_locale_func.c \
   misc/output_format.c \
